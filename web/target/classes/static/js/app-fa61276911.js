angular.module("app",["ngRoute","app.main","app.component1","app.component2","app.books","app.authors","flash"]).config(["$locationProvider",function(o){"use strict";o.html5Mode(!1)}]).value("config",{contextPath:"workshop"}),angular.module("app.main",["ngRoute","app.main.templates","ui.bootstrap","flash"]).config(["$routeProvider",function(o){"use strict";o.when("/",{redirectTo:"/main/welcome"}).when("/main/welcome",{templateUrl:"main/html/welcome.html"}).otherwise({templateUrl:"main/html/page-not-found.html"})}]),angular.module("app.main").controller("AppCntl",["$scope",function(o){"use strict";o.message="Hello!"}]),angular.module("app.main").factory("currentContextPath",["$window",function(o){"use strict";var t="";return{get:function(){var e,a,r,l=t?!1:!0;return l&&(t="/",e=o.location.pathname,e&&e!==t&&(a=e.split("/"),a.length>1&&(r=a[1],r&&(t+=r+"/")))),t}}}]),angular.module("app.main.templates",[]).run(["$templateCache",function(o){o.put("main/html/page-not-found.html",'<!DOCTYPE html><html><body><div class="row"><div class="col-md-12"><h2>Page Not Found!</h2><p>The page you trying to reach could not be found.</p></div></div></body></html>'),o.put("main/html/welcome.html",'<!DOCTYPE html><html><body><div class="row"><div class="col-md-12"><br><br><br><br><div class="col-lg-4"><ul class="list-group"><li class="list-group-item"><a href="#/books/book-list">Books dialog</a></li><li class="list-group-item"><a href="#/authors/authors-list">Authors dialog</a></li><li class="list-group-item"><a href="#/component-1/dialog-a">Dialog A</a></li><li class="list-group-item"><a href="#/component-2/dialog-b">Dialog B</a></li></ul></div></div></div></body></html>')}]),angular.module("app.books",["ngRoute"]).config(["$routeProvider",function(o){"use strict";o.when("/books/book-list",{templateUrl:"books/html/book-list.html",controller:"BookSearchController"}),o.when("/books/add-book",{templateUrl:"books/html/add-book.html"}),o.when("/books/edit-book",{templateUrl:"books/html/edit-book.html"})}]),angular.module("app.books").controller("BookAddController",["$scope","$modal","$window","bookService","$modalInstance","Flash","books",function(o,t,e,a,r,l,n){"use strict";o.title="title";var s;o.books=n,o.author={id:"",firstName:"",lastName:""},o.addedBook={id:null,title:"",authors:[]},o.addAuthor=function(){s=t.open({templateUrl:"authors/html/add-author.html",controller:"AuthorAddController",size:"sm",resolve:{author:function(){return o.author}}}),s.result.then(function(t){o.author=t,o.addedBook.authors.push({id:o.author.id,firstName:o.author.firstName,lastName:o.author.lastName}),o.author.firstName="",o.author.lastName="",o.author.id=""})},o.save=function(){var t=a.saveBook(o.addedBook);t.then(function(){l.create("success","Książka została dodana.","custom-class"),o.books.push(o.addedBook),r.close(o.books)})}}]),angular.module("app.books").controller("BookEditController",["$scope","$modal","$window","bookService","$modalInstance","selectedBook","Flash",function(o,t,e,a,r,l,n){"use strict";o.title="title";var s;o.author={id:"",firstName:"",lastName:""},o.editedAuthor={id:"",firstName:"",lastName:""},o.selectedBook=l,o.newBookTitle=l.title,o.addAuthor=function(){s=t.open({templateUrl:"authors/html/add-author.html",controller:"AuthorAddController",size:"sm",resolve:{author:function(){return o.author}}}),s.result.then(function(t){o.selectedBook.authors.push({firstName:t.firstName,lastName:t.lastName}),o.author.firstName="",o.author.lastName=""})},o.remove=function(t){for(var e=0;e<o.selectedBook.authors.length;e+=1)if(o.selectedBook.authors[e].id===t){o.selectedBook.authors.splice(e,1);break}},o.editAuthor=function(e){o.editedAuthor=e,s=t.open({templateUrl:"authors/html/edit-author.html",controller:"AuthorEditController",size:"sm",resolve:{editedAuthor:function(){return o.editedAuthor}}}),s.result.then(function(t){o.editedAuthor=t})},o.save=function(){o.selectedBook.title=o.newBookTitle;var t=a.saveBook(o.selectedBook);t.then(function(){n.create("success","Książka została edytowana.","custom-class"),r.close()})}}]),angular.module("app.books").controller("BookSearchController",["$scope","$window","$location","bookService","Flash","$modal",function(o,t,e,a,r,l){"use strict";o.books=[],o.gridOptions={data:"books"},o.prefix="",o.isBookAdded=!1,o.isEdited=!1,o.selectedBook={id:"",title:"",authors:""},o.addedBook={id:"",title:"",authors:""};var n=function(t){for(var e=0;e<o.books.length;e+=1)if(o.books[e].id===t){o.books.splice(e,1);break}};o.search=function(){a.search(o.prefix).then(function(t){angular.copy(t.data,o.books)},function(){r.create("danger","Wyjątek","custom-class")})},o.deleteBook=function(o){a.deleteBook(o).then(function(){n(o),r.create("success","Książka została usunięta.","custom-class")})},o.addBook=function(){var t=l.open({templateUrl:"books/html/add-book.html",controller:"BookAddController",size:"lg",resolve:{isBookAdded:function(){return o.isBookAdded},books:function(){return o.books}}});t.result.then(function(t){o.books=t})},o.editBook=function(t){o.selectedBook=t,l.open({templateUrl:"books/html/edit-book.html",controller:"BookEditController",size:"lg",resolve:{isEdited:function(){return o.isEdited},selectedBook:function(){return o.selectedBook}}})}}]),describe("book controller",function(){"use strict";beforeEach(function(){module("app.main"),module("flash"),module("app.books")});var o;beforeEach(inject(function(t){o=t.$new()})),it("search is defined",inject(function(t){t("BookSearchController",{$scope:o}),expect(o.search).toBeDefined()})),it(" bookService.searchBook",inject(function(t,e,a){o.books=[{id:1,title:"Pierwsza książka",authors:[{id:1,firstName:"Jan",lastName:"Kracy"}]},{id:2,title:"Druga książka",authors:[{id:1,firstName:"Jan",lastName:"Kracy"}]}];var r={data:[{id:1,title:"Pierwsza książka",authors:[{id:1,firstName:"Jan",lastName:"Kracy"}]}]};t("BookSearchController",{$scope:o});var l="Pierwsza",n=e.defer();spyOn(a,"search").and.returnValue(n.promise),o.prefix=l,o.search(),n.resolve(r),o.$digest(),expect(a.search).toHaveBeenCalledWith(o.prefix),expect(o.books.length).toBe(1),expect(o.books[0].title).toBe("Pierwsza książka")}))}),angular.module("app.books").factory("bookRestService",["$http","currentContextPath",function(o,t){"use strict";return{search:function(e){return o.get(t.get()+"rest/books/books-by-title",{params:{titlePrefix:e}})},deleteBook:function(e){return o["delete"](t.get()+"rest/books/book/"+e)},saveBook:function(e){return o.post(t.get()+"rest/books/book",e)}}}]),angular.module("app.books").factory("bookService",["bookRestService",function(o){"use strict";return{search:function(t){return o.search(t)},deleteBook:function(t){return o.deleteBook(t)},saveBook:function(t){return o.saveBook(t)}}}]),angular.module("app.authors",["ngRoute"]).config(["$routeProvider",function(o){"use strict";o.when("/authors/authors-list",{templateUrl:"authors/html/author-list.html",controller:"AuthorSearchController"}),o.when("/authors/add-author",{templateUrl:"authors/html/add-author.html"}),o.when("/authors/edit-author",{templateUrl:"authors/html/edit-author.html"})}]),angular.module("app.authors").factory("authorService",["authorRestService",function(o){"use strict";return{findAll:function(){return o.findAll()},saveAuthor:function(t){return o.saveAuthor(t)}}}]),angular.module("app.authors").controller("AuthorAddController",["$scope","$modalInstance",function(o,t){"use strict";o.title="title",o.author={id:"",firstName:"",lastName:""},o.ok=function(){t.close(o.author)}}]),angular.module("app.authors").controller("AuthorEditController",["$scope","$modalInstance","editedAuthor",function(o,t,e){"use strict";o.editedAuthor=e,o.newName=e.firstName,o.newLastName=e.lastName,o.ok=function(){o.editedAuthor.firstName=o.newName,o.editedAuthor.lastName=o.newLastName,t.close(o.editedAuthor)}}]),angular.module("app.authors").controller("AuthorSearchController",["$scope","$window","$location","authorService","Flash","$modal",function(o,t,e,a,r,l){"use strict";o.authors=[],o.gridOptions={data:"authors"},o.initByFindingAll=function(){a.findAll().then(function(t){angular.copy(t.data,o.authors)},function(){r.create("danger","Wyjątek","custom-class")})},o.addAuthor=function(){l.open({templateUrl:"authors/html/add-author.html",controller:"AuthorAddController",size:"lg"})}}]),angular.module("app.authors").factory("authorRestService",["$http","currentContextPath",function(o,t){"use strict";return{findAll:function(){return o.get(t.get()+"rest/authors/authors-list")},saveAuthor:function(e){return o.post(t.get()+"rest/authors/author",e)}}}]),angular.module("app.component1",["ngRoute"]).config(["$routeProvider",function(o){"use strict";o.when("/component-1/dialog-a",{templateUrl:"component-1/html/dialog-a.html"})}]),angular.module("app.component2",["ngRoute","app.component2.templates"]).config(["$routeProvider",function(o){"use strict";o.when("/component-2/dialog-b",{templateUrl:"component-2/html/dialog-b.html"})}]),angular.module("app.component2.templates",[]).run(["$templateCache",function(o){o.put("component-2/html/dialog-b.html","<!DOCTYPE html><html><body><h2>Hello from Dialog B!</h2></body></html>")}]);